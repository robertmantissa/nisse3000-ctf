<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nisse 2000 - Inloggning</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Nisse 2000 Inloggning</h1>
        
        <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 20px 0; border: 2px solid #c41e3a;">
            <p style="text-align: center; color: #721c24;">
                ğŸ”’ <strong>SÃ„KERT SYSTEM</strong> ğŸ”’<br>
                Endast auktoriserade nissar eller administratÃ¶rer fÃ¥r logga in hÃ¤r.
            </p>
        </div>

        <!-- Felmeddelande modal -->
        <div id="errorModal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.45); z-index:1100;">
            <div style="background:#ffffff; max-width:480px; margin:15vh auto; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.35); overflow:hidden;">
                <div style="background:#f8d7da; color:#721c24; padding:14px 18px; border-bottom:1px solid #f5c6cb; display:flex; align-items:center; justify-content:space-between;">
                    <strong>âŒ Fel</strong>
                    <button id="errorCloseBtn" class="btn btn-secondary" style="background:#eee; color:#333; border:1px solid #ccc;">StÃ¤ng</button>
                </div>
                <div style="padding:20px; color:#333;">
                    <p id="errorModalText" style="margin:0; line-height:1.4;">Fel uppstod.</p>
                </div>
            </div>
        </div>

        <form id="loginForm" onsubmit="return handleLogin(event)">
            <div class="form-group">
                <label for="username">AnvÃ¤ndarnamn:</label>
                <input type="text" id="username" name="username" placeholder="VÃ¤lj eller skriv anvÃ¤ndarnamn" list="usernames" required>
                <datalist id="usernames">
                    <option value="nisse"></option>
                    <option value="tomten"></option>
                </datalist>
            </div>

            <div class="form-group">
                <label for="password">LÃ¶senord:</label>
                <input type="password" id="password" name="password" placeholder="Ange lÃ¶senord" required>
            </div>

            <div class="center">
                <button type="submit" class="btn btn-primary">ğŸ„ Logga in ğŸ„</button>
            </div>
        </form>

        <div class="center" style="margin-top: 20px;">
            <button class="btn btn-warning" onclick="showHint(1)">ğŸ’¡ Hint 1</button>
            <button class="btn btn-warning" onclick="showHint(2)" id="hint2btn" style="display: none;">ğŸ’¡ Hint 2</button>
        </div>

        <div id="hint1" class="hint-box">
            <strong>ğŸ’¡ Hint 1:</strong><br>
            LÃ¤ngst fram<br>
        </div>

        <div id="hint2" class="hint-box">
            <strong>ğŸ’¡ Hint 2:</strong><br>
             Att anvÃ¤nda sitt husdjurs namn som lÃ¶senord Ã¤r en klassiker<br>
            <small>(Tips: FÃ¶rsÃ¶k med gemener)</small>
        </div>

        <!-- Modal popup for Tomten warning -->
        <div id="tomtenModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(1px); z-index: 1000;">
            <div style="background: #fff; max-width: 560px; margin: 10vh auto; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); overflow: hidden;">
                <div style="padding: 16px 20px; background: #fff3cd; color: #664d03; border-bottom: 1px solid #ffe69c; display:flex; align-items:center; justify-content:space-between;">
                    <strong>âš ï¸ Tomten-sÃ¤kerhetsvarning</strong>
                    <button id="tomtenCloseBtn" class="btn btn-secondary" style="background:#eee; color:#333; border:1px solid #ccc;">StÃ¤ng</button>
                </div>
                <div style="padding: 20px; color: #333;">
                    <p><strong>TOMTENS INLOGGNING Ã„R BLOCKERAD</strong></p>
                    <p>GPS-position: != nordpolen</p>
                    <p>Tomtens skÃ¤gg: inte ISO 270001-certifierat</p>
                    <p>Inloggningen, avstÃ¤ngd fram till pÃ¥sk + lite till</p>
                    <p style="margin-top:12px;">
                        ğŸ’¡ Hint: Du kommer inte kunna logga in som tomten. Du behÃ¶ver komma Ã¥t hans konto Ã¤ndÃ¥.
                    </p>
                </div>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 15px; background: #e8f5e9; border-radius: 8px; border-left: 5px solid #0f8a5f;">
            <p><strong>ğŸ¯ NivÃ¥ 1: Svagt lÃ¶senord</strong></p>
            <p>MÃ¥nga system har svaga lÃ¶senord. Vad kan Nisse ha fÃ¶r lÃ¶senord? ğŸ¤”</p>
        </div>

        <div style="margin-top: 20px; text-align: center;">
            <a href="index.html" style="color: #0f8a5f; text-decoration: none;">â† Tillbaka till start</a>
        </div>
    </div>

    <script>
        let hintsShown = 0;

        function showHint(hintNumber) {
            if (hintNumber === 1) {
                document.getElementById('hint1').classList.add('visible');
                document.getElementById('hint2btn').style.display = 'inline-block';
                hintsShown = 1;
            } else if (hintNumber === 2) {
                document.getElementById('hint2').classList.add('visible');
                hintsShown = 2;
            }
        }

        function showError(message) {
            const modal = document.getElementById('errorModal');
            const text = document.getElementById('errorModalText');
            if (text) text.textContent = message;
            if (modal) modal.style.display = 'block';
            // Skaka formulÃ¤ret visuellt fÃ¶r extra feedback
            const form = document.getElementById('loginForm');
            if (form) {
                form.style.animation = 'shake 0.5s';
                setTimeout(() => { form.style.animation = ''; }, 500);
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const tomtenModal = document.getElementById('tomtenModal');

            const lowerUser = username.toLowerCase();

            // Blockera fÃ¶rsÃ¶k med 'admin' och visa ASVS-kod
            if (lowerUser === 'admin') {
                showError('ASVS: 6.3.2');
                return false;
            }

            // Tomten blockeras alltid
            if (lowerUser === 'tomten') {
                tomtenModal.style.display = 'block';
                return false;
            }

            // Endast tillÃ¥tna konton: nisse, tomten (tomten redan blockerat ovan)
            const allowed = ['nisse','tomten'];
            if (!allowed.includes(lowerUser)) {
                showError(`Konto "${username}" finns inte i systemet.`);
                // Automatisk hint efter fÃ¶rsta kontofel om inga hints visats
                if (hintsShown === 0) {
                    setTimeout(() => { showHint(1); }, 800);
                }
                return false;
            }

            // LÃ¶senordscheck (endast demonstrativt: rudolf)
            if (password.toLowerCase() === 'rudolf') {
                const targetRole = lowerUser === 'nisse';
                window.location.href = 'dashboard.html?role=' + targetRole;
                return false;
            } else {
                showError('Fel lÃ¶senord! FÃ¶rsÃ¶k igen.');
                if (hintsShown === 0) {
                    setTimeout(() => { showHint(1); }, 800);
                }
                return false;
            }
        }


        // StÃ¤ng modal via knapp eller klick pÃ¥ overlay
        (function modalCloseSetup(){
            // Tomten modal
            const tomten = document.getElementById('tomtenModal');
            const tomtenCloseBtn = document.getElementById('tomtenCloseBtn');
            if (tomten) {
                const hideTomten = () => { tomten.style.display = 'none'; };
                if (tomtenCloseBtn) tomtenCloseBtn.addEventListener('click', hideTomten);
                tomten.addEventListener('click', (e) => { if (e.target === tomten) hideTomten(); });
            }
            // Error modal
            const err = document.getElementById('errorModal');
            const errCloseBtn = document.getElementById('errorCloseBtn');
            if (err) {
                const hideErr = () => { err.style.display = 'none'; };
                if (errCloseBtn) errCloseBtn.addEventListener('click', hideErr);
                err.addEventListener('click', (e) => { if (e.target === err) hideErr(); });
            }
        })();

        // LÃ¤gg till shake-animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
